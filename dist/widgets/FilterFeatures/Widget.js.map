{"version":3,"sources":["../../../widgets/FilterFeatures/Widget.js"],"names":["declare","BaseWidget","_WidgetsInTemplateMixin","Query","QueryTask","dom","on","baseClass","postCreate","inherited","arguments","console","log","self","startup","_urlDepa","config","departamento","url","_fieldCodDepa","value","_fieldNomDepa","label","clause","_urlProv","provincia","_fieldCodProv","_fieldNomProv","_urlDist","distrito","_fieldCodDist","_fieldNomDist","_turnOffAllLayers","_filterFeature","depaSelectAttachPoint","_filterFeatureDepa","evt","_zoomExtendSelected","provSelectAttachPoint","_filterFeatureProv","distSelectAttachPoint","_filterFeatureDist","urlServiceDist","valueFieldDist","urlService","valueField","labelField","dojonodeAlias","options","queryTask","query","where","outFields","execute","results","i","features","opt","attributes","push","set","field","returnGeometry","executeForExtent","extent","map","setExtent","layerIds","graphicsLayerIds","feature","getLayer","hide"],"mappings":"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","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\r\nimport BaseWidget from 'jimu/BaseWidget';\r\nimport _WidgetsInTemplateMixin from 'dijit/_WidgetsInTemplateMixin';\r\nimport Query from \"esri/tasks/query\";\r\nimport QueryTask from \"esri/tasks/QueryTask\";\r\nimport dom from \"dojo/dom\";\r\nimport on from \"dojo/on\";\r\n\r\n// To create a widget, you need to derive from BaseWidget.\r\nexport default declare([\r\n  BaseWidget, \r\n  _WidgetsInTemplateMixin, \r\n  Query, \r\n  QueryTask], {\r\n\r\n  // Custom widget code goes here\r\n\r\n  baseClass: 'filter-features',\r\n\r\n  // add additional properties here\r\n\r\n  // methods to communication with app container:\r\n  postCreate () {\r\n    this.inherited(arguments);\r\n    console.log('FilterFeatures::postCreate');\r\n    self = this;\r\n\r\n    // this._urlDepa;\r\n    // this._fieldCodDepa;\r\n    // this._fieldNomDepa;\r\n    // this._urlProv;\r\n    // this._fieldCodProv;\r\n    // this._fieldNomPrv;\r\n    // this._urlDist;\r\n    // this._fieldCodDist;\r\n    // this._fieldNomDist;\r\n  },\r\n  \r\n  startup() {\r\n    this.inherited(arguments);\r\n    _urlDepa = this.config.departamento.url;\r\n    _fieldCodDepa = this.config.departamento.value;\r\n    _fieldNomDepa = this.config.departamento.label;\r\n    clause = \"1=1\"\r\n\r\n    _urlProv = this.config.provincia.url;\r\n    _fieldCodProv = this.config.provincia.value;\r\n    _fieldNomProv = this.config.provincia.label;\r\n    _urlDist = this.config.distrito.url;\r\n    _fieldCodDist = this.config.distrito.value;\r\n    _fieldNomDist = this.config.distrito.label;\r\n\r\n    this._turnOffAllLayers();\r\n\r\n    this._filterFeature(_urlDepa, clause, _fieldCodDepa, _fieldNomDepa, self.depaSelectAttachPoint);\r\n  },\r\n\r\n  _filterFeatureDepa(evt){\r\n    var clause = `${_fieldCodProv} like '${evt}%'`\r\n\r\n    this._zoomExtendSelected(_urlDepa, _fieldCodDepa, evt);\r\n    this._filterFeature(_urlProv, clause, _fieldCodProv, _fieldNomProv, self.provSelectAttachPoint);\r\n  },\r\n\r\n  _filterFeatureProv(evt){\r\n    var clause = `${_fieldCodDist} like '${evt}%'`\r\n\r\n    this._zoomExtendSelected(_urlProv, _fieldCodProv, evt);\r\n    this._filterFeature(_urlDist, clause, _fieldCodDist, _fieldNomDist, self.distSelectAttachPoint);\r\n  },\r\n\r\n  _filterFeatureDist(evt){\r\n    var urlServiceDist = this.config.distrito.url;\r\n    var valueFieldDist = this.config.distrito.value;\r\n    var value = evt;\r\n\r\n    this._zoomExtendSelected(urlServiceDist, valueFieldDist, evt);\r\n  },\r\n\r\n  _filterFeature(urlService, clause, valueField, labelField, dojonodeAlias){\r\n    var options = []\r\n    var queryTask = new QueryTask(urlService);\r\n    var query = new Query();\r\n    query.where = clause;\r\n    query.outFields = [valueField, labelField];\r\n    queryTask.execute(query, function(results){\r\n      for(var i in results.features){\r\n        var opt = {\r\n          'label': results.features[i].attributes[labelField],\r\n          'value': results.features[i].attributes[valueField]\r\n        };\r\n        options.push(opt);\r\n      }\r\n      dojonodeAlias.set('options', options);\r\n    });\r\n  },\r\n\r\n  _zoomExtendSelected(urlService, field, value){\r\n    var queryTask = new QueryTask(urlService);\r\n    var clause = `${field}='${value}'`;\r\n    var query = new Query();\r\n    query.where = clause;\r\n    query.returnGeometry = true;\r\n    queryTask.executeForExtent(query, function(results){\r\n      var extent = results.extent;\r\n      self.map.setExtent(extent, true);\r\n    });\r\n  },\r\n\r\n  _turnOffAllLayers(){\r\n    var layerIds = this.map.graphicsLayerIds;\r\n    var feature;\r\n    for (var i in layerIds){\r\n      feature = this.map.getLayer(layerIds[i]);\r\n      feature.hide();\r\n    }\r\n  }\r\n  // onOpen() {\r\n  //   console.log('FilterFeatures::onOpen');\r\n  // },\r\n  // onClose(){\r\n  //   console.log('FilterFeatures::onClose');\r\n  // },\r\n  // onMinimize(){\r\n  //   console.log('FilterFeatures::onMinimize');\r\n  // },\r\n  // onMaximize(){\r\n  //   console.log('FilterFeatures::onMaximize');\r\n  // },\r\n  // onSignIn(credential){\r\n  //   console.log('FilterFeatures::onSignIn', credential);\r\n  // },\r\n  // onSignOut(){\r\n  //   console.log('FilterFeatures::onSignOut');\r\n  // }\r\n  // onPositionChange(){\r\n  //   console.log('FilterFeatures::onPositionChange');\r\n  // },\r\n  // resize(){\r\n  //   console.log('FilterFeatures::resize');\r\n  // }\r\n});\r\n"]}